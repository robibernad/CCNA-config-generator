!
! Security Configuration - Access Control Lists
!
{% for acl in standardAcls %}
! Standard ACL {{ acl.number }}
{% for entry in acl.entries %}
{% if entry.source == 'any' %}
access-list {{ acl.number }} {{ entry.action }} any
{% elif entry.wildcard %}
access-list {{ acl.number }} {{ entry.action }} {{ entry.source }} {{ entry.wildcard }}
{% else %}
access-list {{ acl.number }} {{ entry.action }} host {{ entry.source }}
{% endif %}
{% endfor %}
!
{% endfor %}

{% for acl in extendedAcls %}
{% if acl.numberOrName.isdigit() %}
! Extended ACL {{ acl.numberOrName }}
{% for entry in acl.entries %}
access-list {{ acl.numberOrName }} {{ entry.action }} {{ entry.protocol }} {{ entry.source }}{% if entry.sourceWildcard %} {{ entry.sourceWildcard }}{% endif %} {{ entry.destination }}{% if entry.destinationWildcard %} {{ entry.destinationWildcard }}{% endif %}{% if entry.port %} eq {{ entry.port }}{% endif %}

{% endfor %}
{% else %}
ip access-list extended {{ acl.numberOrName }}
{% for entry in acl.entries %}
 {{ entry.action }} {{ entry.protocol }} {{ entry.source }}{% if entry.sourceWildcard %} {{ entry.sourceWildcard }}{% endif %} {{ entry.destination }}{% if entry.destinationWildcard %} {{ entry.destinationWildcard }}{% endif %}{% if entry.port %} eq {{ entry.port }}{% endif %}

{% endfor %}
 exit
{% endif %}
!
{% endfor %}

{% for app in aclApplications %}
interface {{ app.interface }}
 ip access-group {{ app.acl }} {{ app.direction }}
!
{% endfor %}

!
! Security Configuration - IPsec VPN
!
{% if ipsecPhase1 %}
! --- IKE Phase 1 (ISAKMP) ---
{% for p1 in ipsecPhase1 %}
crypto isakmp policy {{ p1.policyId }}
 encr {{ p1.encryption }}
 hash {{ p1.hash }}
 authentication {{ p1.authentication }}
 group {{ p1.group }}
 lifetime {{ p1.lifetime }}
!
crypto isakmp key {{ p1.key }} address 0.0.0.0
{% endfor %}
{% endif %}

{% if ipsecPhase2 %}
! --- IKE Phase 2 (Transform Sets) ---
{% for p2 in ipsecPhase2 %}
crypto ipsec transform-set {{ p2.name }} {{ p2.protocol }}
 mode {{ p2.mode }}
!
{% endfor %}
{% endif %}

{% if ipsecMaps %}
! --- Crypto Maps ---
{% for map in ipsecMaps %}
crypto map {{ map.name }} {{ map.priority }} ipsec-isakmp
 set peer {{ map.peerIp }}
 set transform-set {{ map.transformSet }}
 match address {{ map.matchAcl }}
!
{% endfor %}
{% endif %}
